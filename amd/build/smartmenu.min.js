define(["jquery","core/moremenu"],function($){const Selectors={dropDownMenu:"dropdownmoremenu",forceOut:"force-menu-out",navLink:"nav-link",dropDownItem:"dropdown-item",classes:{dropDownMenuList:".dropdownmoremenu ul.dropdown-menu",forceOut:".dropdownmoremenu .force-menu-out"}};const addSubmenu=()=>{var submenu=document.querySelectorAll("nav.moremenu .dropdown-submenu");if(submenu!==null){submenu.forEach(item=>{item.addEventListener("click",e=>{var target=e.currentTarget;hideSubmenus(target);target.classList.toggle("show");e.stopPropagation()})})}$(document).on("hidden.bs.dropdown",e=>{var target=e.relatedTarget.parentNode;var submenus=target.querySelectorAll(".dropdown-submenu.show");if(submenus!==null){submenus.forEach(e=>e.classList.remove("show"))}});document.addEventListener("click",e=>{var dropdown=e.target.closest(".dropdownmoremenu");var subMenu=e.target.closest(".dropdown-submenu");if(dropdown&&subMenu!==null){dropdown.querySelectorAll(".dropdown-submenu.show").forEach(menu=>{menu.classList.remove("show")});subMenu.classList.toggle("show")}var dropdownMenu=e.target.parentNode.classList.contains("dropdown");if(dropdown&&dropdownMenu){dropdown.querySelectorAll(".dropdown-menu.show").forEach(menu=>{if(menu!=e.target.closest(".dropdown-menu")){menu.classList.remove("show")}})}},true);var helpIcon=document.querySelectorAll(".moremenu .dropdown .menu-helpicon");if(helpIcon!==null){helpIcon.forEach(icon=>{icon.addEventListener("click",e=>{e.stopPropagation()})})}};const hideSubmenus=target=>{var visibleMenu=document.querySelectorAll("nav.moremenu .dropdown-submenu.show");if(visibleMenu!==null){visibleMenu.forEach(el=>{if(el!=target){el.classList.remove("show")}})}};const cardScroll=()=>{var cards=document.querySelectorAll(".card-dropdown.card-overflow-no-wrap");if(cards!==null){var scrollStart;var scrollMoved;let startPos,scrollPos;cards.forEach(card=>{var scrollElement=card.querySelector(".dropdown-menu");scrollElement.addEventListener("mousedown",e=>{scrollStart=true;var target=e.currentTarget.querySelector(".card-block-wrapper");startPos=e.pageX;scrollPos=target.scrollLeft});scrollElement.addEventListener("mousemove",e=>{e.preventDefault();if(!scrollStart){return}scrollMoved=true;var target=e.currentTarget.querySelector(".card-block-wrapper");const scroll=e.pageX-startPos;target.scrollLeft=scrollPos-scroll});scrollElement.addEventListener("click",e=>{if(scrollMoved){e.preventDefault();scrollMoved=false}e.stopPropagation()});scrollElement.addEventListener("mouseleave",()=>{scrollStart=false;scrollMoved=false});scrollElement.addEventListener("mouseup",()=>{scrollStart=false})})}};const autoCollapse=()=>{var primaryNav=document.querySelector(".primary-navigation ul.more-nav");if(primaryNav!=undefined){setOutMenuPositions(primaryNav);moveOutMoreMenu(primaryNav)}var menuBar=document.querySelector("nav.menubar ul.more-nav");if(menuBar!=undefined){setOutMenuPositions(menuBar);moveOutMoreMenu(menuBar)}window.onresize=e=>{if(e.isTrusted){moveOutMoreMenu(primaryNav);moveOutMoreMenu(menuBar)}}};const setOutMenuPositions=navMenu=>{if(navMenu===undefined||navMenu===null){return}var li=Array.from(navMenu.children).filter(e=>!e.classList.contains(Selectors.dropDownMenu));var position=0;li.forEach(menu=>{position=li.indexOf(menu);menu.dataset.orgposition=position});var moreMenu=navMenu.querySelector(Selectors.classes.dropDownMenuList);Array.from(moreMenu.children).forEach(menu=>{menu.dataset.orgposition=position++})};const reArrangeMenuOrgPositions=navMenu=>{var li=Array.from(navMenu.children).sort((a,b)=>a.dataset.orgposition-b.dataset.orgposition);li.forEach(menu=>navMenu.appendChild(menu))};const moveOutMoreMenu=navMenu=>{if(navMenu===null){return}var li=Array.from(navMenu.children).reverse().filter(e=>!e.classList.contains(Selectors.forceOut)&&!e.classList.contains(Selectors.dropDownMenu));if(li.length<1){return}var outMenus=navMenu.querySelectorAll(Selectors.classes.forceOut);var menuslist=[];if(outMenus===null){return}outMenus.forEach(menu=>{menu.querySelector("a").classList.remove(Selectors.dropDownItem);menu.querySelector("a").classList.add(Selectors.navLink);menuslist.push(menu);menu.parentNode.removeChild(menu)});var moveMenus=[];menuslist.forEach(menu=>{if(navMenu.insertBefore(menu,navMenu.lastElementChild)&&li.length>0){moveMenus.push(li.shift())}});moveMenus.forEach(menu=>{navMenu.insertBefore(menu,navMenu.lastElementChild)});window.dispatchEvent(new Event("resize"));reArrangeMenuOrgPositions(navMenu)};return{init:()=>{addSubmenu();cardScroll();autoCollapse()}}});